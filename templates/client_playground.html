{% extends "base.html" %}
{% block title %}ูุงุฌูุฉ ุงูุนููู{% endblock %}
{% block content %}

<h1>ุชูุฑูู ููุธู (VNeST)</h1>

<!-- Preview badge if ?preview=1 -->
<div class="card" id="preview-banner" style="display:none">
  <strong>ูุถุน ุงูุชุฌุฑุจุฉ:</strong> ูุฐู ุงูุชุฌุฑุจุฉ ูู ุชูุญูุธ ูู ุงููุชุงุฆุฌ.
</div>

<!-- Step 0: Start -->
<div class="card" id="client-start">
  <label>ุงูุชุจ ุงุณูู (ุงุฎุชูุงุฑู)
    <input type="text" id="client-name" placeholder="ุงุณู ุงูุนููู">
  </label>
  <div class="flex-gap">
    <button class="btn" id="btn-start" data-token="{{ token or '' }}">ุงุจุฏุฃ</button>
    <button class="btn outline" id="btn-tts-toggle" type="button">๐ ุชุดุบูู ุงููุฑุงุกุฉ ุงูุขููุฉ</button>
  </div>
</div>

<!-- Step 1: Verb -->
<div class="card step hidden" id="step-verb" placeholder="ูู ูููู ุงู ููุนู"></div> <span>{{ verb }}</span>
  <label>ุงูุฅุฌุงุจุฉ:
    <div class="flex-gap">
      <input type="text" id="answer-subject" placeholder=" ">
      <button class="btn small outline mic" data-target="#answer-subject" type="button">๐ค ุฅููุงุก</button>
    </div>
  </label>
  <button class="btn" data-next="#step-object">ุงูุชุงูู</button>
</div>

<!-- Step 2: Object -->
<div class="card step hidden" id="step-object">
  <div name="Verb_Prompt"> </div> <!-- Verb injection from flask-->
  <div class="bubbles">
    <span class="bubble verb">{{ verb }}</span>
    <span class="bubble subject" id="bubble-subject">โ</span>
  </div>
  <label>ุงูุฅุฌุงุจุฉ:
    <div class="flex-gap">
      <input type="text" id="answer-object" placeholder="ูุซุงู: ุงูุณูุฏููุชุด">
      <button class="btn small outline mic" data-target="#answer-object" type="button">๐ค</button>
    </div>
  </label>
  <button class="btn" data-next="#step-place">ุงูุชุงูู</button>
</div>

<!-- Step 3: Place -->
<div class="card step hidden" id="step-place">
  <h3>ุฃูู <span id="subj2">โ</span> <span class="verb">{{ verb or "ุฃูู" }}</span> <span id="obj2">โ</span>ุ</h3>
  <div class="bubbles">
    <span class="bubble verb">{{ verb or "ุฃูู" }}</span>
    <span class="bubble subject" id="bubble-subject2">โ</span>
    <span class="bubble object" id="bubble-object2">โ</span>
  </div>
  <label>ุงูุฅุฌุงุจุฉ:
    <div class="flex-gap">
      <input type="text" id="answer-place" placeholder="ูุซุงู: ุงููุทุนู">
      <button class="btn small outline mic" data-target="#answer-place" type="button">๐ค ุฅููุงุก</button>
    </div>
  </label>
  <button class="btn" data-next="#step-dnd">ุงูุชุงูู</button>
</div>

<!-- Step 4: Drag & drop (two sentences) -->
<div class="card step hidden" id="step-dnd">
  <h3>ุฑุชูุจ ุงููููุงุช ุงูุขุชูุฉ ุฅูู ุฌููุชูู</h3>
  <p class="muted">ุงูุชุณูุณู ุงูููุจูู: ูุงุนู โ ูุนู โ ููุนูู โ ููุงู ุฃู ูุนู โ ูุงุนู โ ููุนูู โ ููุงู.</p>
  <div class="dnd-bank" id="bank"></div>
  <div class="dnd-targets">
    <div>
      <h4>ุงูุฌููุฉ 1</h4>
      <div class="dropzone" id="sent1"></div>
    </div>
    <div>
      <h4>ุงูุฌููุฉ 2</h4>
      <div class="dropzone" id="sent2"></div>
    </div>
  </div>
  <button class="btn" id="btn-check-order">ุชุญูู</button>
  <div class="popup hidden" id="order-feedback"></div>
  <button class="btn hidden" id="to-typing" data-next="#step-typing">ุงูุชุงูู</button>
</div>

<!-- Step 5: Type sentences + feedback -->
<div class="card step hidden" id="step-typing">
  <h3>ุงูุชุจ ุงูุฌูู:</h3>
  <label>1
    <div class="flex-gap">
      <input type="text" id="sent1-text" placeholder="ุงูุชุจ ุงูุฌููุฉ ุงูุฃููู">
      <button class="btn small outline mic" data-target="#sent1-text" type="button">๐ค ุฅููุงุก</button>
    </div>
  </label>
  <label>2
    <div class="flex-gap">
      <input type="text" id="sent2-text" placeholder="ุงูุชุจ ุงูุฌููุฉ ุงูุซุงููุฉ">
      <button class="btn small outline mic" data-target="#sent2-text" type="button">๐ค ุฅููุงุก</button>
    </div>
  </label>
  <div class="flex-gap">
    <button class="btn" id="btn-check-grammar">ุชุญูู ูุญูููุง</button>
    <button class="btn outline" id="btn-tts-read" type="button">๐ ุงูุฑุฃ ุงูุฌูู</button>
  </div>
  <div class="popup hidden" id="grammar-feedback"></div>
  <button class="btn hidden" id="to-yn" data-next="#step-yn">ุงูุชุงูู</button>
</div>

<!-- Step 6: Y/N grammar -->
<div class="card step hidden" id="step-yn">
  <h3>ูู ุงูุฌูู ุงูุขุชูุฉ ุตุญูุญุฉ ูุบูููุงุ</h3>
  <p id="yn-stimulus">ุงููุทุฉ ุชุฃูู ุงูุชููุฉ ุฎุงุฑุฌ ุจูุชู</p>
  <div class="yn-buttons">
    <button class="btn outline" data-answer="yes">ูุนู</button>
    <button class="btn" data-answer="no">ูุง</button>
  </div>
  <div class="popup hidden" id="yn-feedback"></div>
  <button class="btn hidden" id="to-sem" data-next="#step-sem">ุงูุชุงูู</button>
</div>

<!-- Step 7: Y/N semantics -->
<div class="card step hidden" id="step-sem">
  <h3>ูู ุงูุฌูู ุงูุขุชูุฉ ุตุญูุญุฉ ูุนููููุงุ</h3>
  <p id="sem-stimulus">ุณูุฃูู ุงูุฑุฌู ุงูุฑุฒ ูู ุจูุชู ุฃูุณ</p>
  <div class="yn-buttons">
    <button class="btn outline" data-answer="yes">ูุนู</button>
    <button class="btn" data-answer="no">ูุง</button>
  </div>
  <div class="popup hidden" id="sem-feedback"></div>
  <button class="btn hidden" id="finish">ุฅููุงุก</button>
</div>

<!-- Step 8: Finish -->
<div class="card step hidden" id="step-finish">
  <h3>ุดูุฑูุง! ุชู ุฅููุงุก ุงูุชูุฑูู.</h3>
  <div class="flex-gap">
    <a class="btn" href="{{ url_for('slp_dashboard') }}">ุฑุฌูุน</a>
    <button class="btn outline" id="finish-ok">ุฅุฑุณุงู</button>
  </div>
</div>

<!-- Azure Speech SDK (browser) -->
<script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
<script>
  window.SPEECH_REGION = "{{ speech_region or '' }}";
  window.SPEECH_VOICE  = "{{ speech_voice or 'ar-SA-HamedNeural' }}";
  window.SPEECH_ENABLED = "{{ 'true' if speech_enabled else 'false' }}";
</script>
<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}
